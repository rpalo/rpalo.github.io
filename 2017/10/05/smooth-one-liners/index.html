<!DOCTYPE html>
<html lang="en">
    <head>
        
        <!-- Bootstrap Setup -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="ROBOTS" content="INDEX,FOLLOW">
        <meta name="description" content="Don't have time to look up that awk/sed syntax?  Too rushed to write a full script?  Let these Ruby one-liners do the heavy lifting for you.">
        <meta name="keywords" content="blog, code, developer, programming, learning, teaching, dev, Ryan, Ryan Palo, ruby, bash, sysadmin">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="assert_not magic? | Smooth Ruby One-Liners">
        <meta name="twitter:site" content="@paytastic">
        <meta name="twitter:description" content="Don't have time to look up that awk/sed syntax?  Too rushed to write a full script?  Let these Ruby one-liners do the heavy lifting for you.">
        <meta name="twitter:image" content="http://assertnotmagic.com/img/one-liner.png">
        <meta name="twitter:creator" content="@paytastic">
        <meta name="og:url" content="http://assertnotmagic.com/2017/10/05/smooth-one-liners/">
        <meta name="og:title" content="assert_not magic? | Smooth Ruby One-Liners">
        <meta name="og:description" content="Don't have time to look up that awk/sed syntax?  Too rushed to write a full script?  Let these Ruby one-liners do the heavy lifting for you.">
        <meta name="og:image" content="http://assertnotmagic.com/img/one-liner.png">

        <!-- Favicon settings -->
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/manifest.json">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#222222">
        <meta name="theme-color" content="#ffffff">
        
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">
        
        <title>assert_not magic?</title>
    </head>
    <body>
        
<nav id="main-nav">
    <a href="/" class="mobile-home">assert_not magic?</a>
    <ul>
        <li class="logo"><a href="/">assert_not magic?</a></li>
        <li><a href="/posts/">All Posts</a></li>
        <li><a href="/about/">About</a></li>
        <li><a href="/sketches/">Sketches</a></li>
        <li><a href="/todo/">TODO</a></li>
        <li><a href="/uses/">Uses</a></li>
    </ul>
</nav>
        <div class="container main">
                <article class="site-wrap">
    <div id="cover">
        
        <img alt="Cover Image" class="cover-image" src="/img/one-liner.png">
        
    </div>
    <h1>Smooth Ruby One-Liners</h1>
    <p>When I first started learning Ruby, the first book I read had a chapter at the front about all of the command line options and flags for the <code class="highlighter-rouge">ruby</code> command.  Missing the point as usual, I flipped quickly through that section without reading much.  “Yeah, yeah, yeah,” I said to myself as I pulled open my editor.  “Whatever.  Just get to the good stuff.  Show me those <em>objects</em>!  Those <em>classes!</em>”  Well, I’m here to say: I Missed Out.  A chapter on a different book I’m now reading (<a href="http://www.apress.com/us/book/9781590598214">Practical Ruby for System Administration</a> by Andre Ben-Hamou) also had a section about this, and this time I paid attention.  Now I want to share the highlights with everybody else!</p>

<h2 id="the-good-stuff">The Good Stuff</h2>

<h3 id="simple-execution">Simple Execution</h3>

<p>Let’s start simple.  The <code class="highlighter-rouge">-e</code> flag will have the Ruby interpreter execute a command string inline and output the result to <code class="highlighter-rouge">stdout</code>.  Useful if you can’t remember that darn Bash command for doing floating point math (<em>hint: it’s <code class="highlighter-rouge">bc</code></em>)!</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -e <span class="s1">'puts (Math.sqrt(32**2/57.2))'</span> &gt; calc.txt
</code></pre>
</div>

<p>A note about quotation marks.  Many of the useful Ruby one-liners contain special variables like <code class="highlighter-rouge">$_, $&lt;, and $.</code>.  This is all fine and dandy until you add Bash string interpolation into the mix.  Since you interpolate variables like this in Bash:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"That's no </span><span class="nv">$silly_thing</span><span class="s2">, that's my wife!"</span>
</code></pre>
</div>

<p>If you surround your Ruby command with double quotes, your special variables will have unpredictable results.  It’s best to stick to single quotes around the command at all times.</p>

<p>The first example is a bit useful if you’re stubbornly refusing to Google Bash commands, but only slightly more convenient.  But stay with me, because we’re just getting warmed up.</p>

<h3 id="line-by-line-processing">Line-by-Line Processing</h3>

<p>The <code class="highlighter-rouge">-n</code> flag wraps your executed one-liner in an implicit <code class="highlighter-rouge">while gets ... end</code> block.  When you combine this with the usage of Ruby’s special global variable <code class="highlighter-rouge">$_</code>, which stores the result of the most recent <code class="highlighter-rouge">Kernel.gets</code> command, you can do some nice (<strong>and readable</strong>) file processing!</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -ne <span class="s1">'puts $_.strip if $_ =~ /soup/'</span> /home/rpalo/recipes
</code></pre>
</div>

<p>Which will strip out excess whitespace and print me every line that contains the word ‘soup’.  I don’t know about you, but a script like that would be critical to my infrastructure.</p>

<p>If you get tired of typing <code class="highlighter-rouge">puts $_.something.something</code> after a while, don’t worry.  The <code class="highlighter-rouge">-p</code> flag drops an implicit <code class="highlighter-rouge">print $_</code> at the end of your command, so you can just modify the variable.  We can clean up the previous example like this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -pe <span class="s1">'$_strip! if $_ =~ /soup/'</span> /home/rpalo/recipes
</code></pre>
</div>

<p>You’re saving at least 4 whole characters there.  Don’t spend it all in one place.</p>

<h3 id="in-place-file-editing">In-Place File Editing</h3>

<p>“I feel like I’m not a real developer because I haven’t taken the time to learn to use the <code class="highlighter-rouge">sed</code> or <code class="highlighter-rouge">awk</code> command!”  Firstly, that’s silly.  You should disregard anyone who begins any sentence with the phrase, “You’re not a real developer if…”.  Additionally, you can make them feel sad when you edit files in place (like <code class="highlighter-rouge">sed -i</code> does)!  Here’s four ways to do this, in order of increasing levels of shwoopiness.  Let’s say you wanted to remove the default comments from a configuration file (not recommended unless you promise to add your own back in).</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -pe <span class="s1">'$_.gsub!(/#.*$/, "")'</span> .myconfig &gt; .myconfig
</code></pre>
</div>

<p>Redirect the modified lines to overwrite the file instead of printing to <code class="highlighter-rouge">STDOUT</code>.  You can leave that off if you use the <code class="highlighter-rouge">-i</code> flag.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -i -pe <span class="s1">'$_.gsub!(/#.*$/, "")'</span> .myconfig
</code></pre>
</div>

<p>This works great when you want to run this command against multiple files.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -i -pe <span class="s1">'$_.gsub!(/#.*$/, "")'</span> <span class="k">*</span>.conf
</code></pre>
</div>

<p>The glob match will run through each of the files ending in .conf and overwrite them.</p>

<p>Lastly, if you’re paranoid and risk averse (i.e. you’ve been using the terminal long enough to know the pain of overwriting a file with an error in your script and losing everything – #GodBlessGit), you can add a file extension to your <code class="highlighter-rouge">-i</code> flag like this: <code class="highlighter-rouge">-i.bak</code> and it will save the old version with that file extension before writing; <code class="highlighter-rouge">.myconfig</code> won’t have comments, but there will be a new <code class="highlighter-rouge">.myconfig.bak</code> that still does.</p>

<blockquote>
  <p>There MUST be NO space between the <code class="highlighter-rouge">-i</code> and the backup file extension or it won’t work.  You have been warned.</p>
</blockquote>

<h3 id="farming-the-rows-and-fields">Farming the Rows and Fields</h3>

<p>I want to talk about two more special global variables: <code class="highlighter-rouge">$&lt; and $.</code>.  The first one refers to the file that was input.  The second one refers to the current line number.  (Note that this means that <code class="highlighter-rouge">$. and $&lt;.lineno</code> are synonymous).  You can implement a rough version of <code class="highlighter-rouge">head</code> like this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -ne <span class="s1">'puts $_ if $. &lt;= 10'</span> test.txt
</code></pre>
</div>

<p>To use fields in files that might be delimited, such as csv’s or system files like <code class="highlighter-rouge">/etc/passwd</code>, you might first try doing this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -ne <span class="s1">'puts $_.split.first + $_.split.last'</span> test.txt
</code></pre>
</div>

<p>That works, but you can have the heavy lifting done for you with <code class="highlighter-rouge">-a</code>, which stands for “autosplit”.  It drops the pre-split fields into a special variable called <code class="highlighter-rouge">$F</code>.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -a -ne <span class="s1">'puts $F.first + $F.last'</span> test.txt
</code></pre>
</div>

<p>The above example only works with spaces as delimiters, though!  you can specify <em>that</em> with <code class="highlighter-rouge">-F</code>.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -a -F: -ne <span class="s1">'puts $F.first'</span> /etc/passwd
</code></pre>
</div>

<h3 id="setup-and-teardown">Setup and Teardown</h3>

<p>If you <em>have</em> used <code class="highlighter-rouge">awk</code>, then this next part may be familiar.  You can do some initializing before you run through the input file and teardown/final output after, using <code class="highlighter-rouge">BEGIN</code> and <code class="highlighter-rouge">END</code> blocks.  Useful for things like counting the total number of lines that match a pattern.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -ne <span class="s1">'BEGIN { ducks = 0 }; ducks += 1 if $_ =~ /ducks/; END { puts ducks }'</span> duckfile.txt
</code></pre>
</div>

<p>Using this setup and teardown, your one-liners get quite a bit more powerful.</p>

<h3 id="requiring-modules">Requiring Modules</h3>

<p>You’ve probably actually used this in other ways, but you can require gems and modules from the standard library with the <code class="highlighter-rouge">-r</code> command.  For instance, to list out your machine’s IP addresses, you could do this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -rsocket -e <span class="s1">'puts Socket.ip_address_list.map(&amp;:inspect)'</span>
</code></pre>
</div>

<p>Play with primes!</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ruby -rprime -e <span class="s1">'puts Prime.first(20)'</span>
</code></pre>
</div>

<h2 id="wrapping-up">Wrapping Up</h2>

<p>Overall, these may not give you a 10x productivity boost, but they are fun and I feel like they provide an interesting approach.  They seem especially useful if you’ve been deep into a Ruby project and switching your brain over to Bash is too much work.  Halfway through writing this post, I went to Google, and there are an amazing number of blog posts about this topic.  (Kind of made me feel lame for posting about it, to be honest).  But it’s a fun topic, and it’s just one more of those things that makes Ruby fun to use, so I thought it would be good to share.  Anyways, tweet/message me if you’ve got any cool Ruby one-liners that you use all the time!  I’ll add them to this list:</p>

<h2 id="submitted-by-awesome-people">Submitted by Awesome People</h2>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># First two submitted by me to avoid a sad empty list here</span>
<span class="c"># Delete trailing whitespace</span>
<span class="gp">$ </span>ruby -pe <span class="s1">'gsub(/\s+$/, "\n")'</span>

<span class="c"># Prints too long lines</span>
<span class="gp">$ </span>ruby -ne <span class="s1">'puts $_ if $_.length &gt; 80'</span>
</code></pre>
</div>


    <small>
        Author: Ryan Palo | Tags: 
        
        <a href="/tags/ruby/">ruby</a>
        
        <a href="/tags/bash/">bash</a>
        
        <a href="/tags/sysadmin/">sysadmin</a>
        
    </small>

    <hr>

<!-- Footer for Homepage -->
  <div id="home-footer">
    <div id="left-home-footer">
      <!-- Featured Posts List -->
      <h2>Featured Posts</h2>
      <ul class="post-list">
        <li>
          <span class="post-meta">Jan 18, 2017</span><br />
          <a class="post-link" href="/2017/01/18/assert-not-magic/">Assert Not Magic</a>
        </li>
        
          <li>
            <span class="post-meta">Nov 4, 2017</span><br/>
            <a class="post-link" href="/2017/11/04/git-wrecked/">Git Wrecked — Keeping Your Branches Synced Without Breaking Things</a>
          </li>
        
          <li>
            <span class="post-meta">Oct 28, 2017</span><br/>
            <a class="post-link" href="/2017/10/28/e-for-everywhere/">E for Everywhere</a>
          </li>
        
          <li>
            <span class="post-meta">Oct 25, 2017</span><br/>
            <a class="post-link" href="/2017/10/25/accelerated-vimprovement/">Accelerated Vim-Provement</a>
          </li>
        
      </ul>
    </div>
    <div id="center-home-footer">
      <!-- Spacer -->
    </div>
    <div id="right-home-footer">
      <!-- Tags List -->
      <h2>Tags</h2>
      <p>
        
        <a href="/tags/python/" style="font-size: 54px">python | </a>
        
        <a href="/tags/django/" style="font-size: 22px">django | </a>
        
        <a href="/tags/rails/" style="font-size: 14px">rails | </a>
        
        <a href="/tags/algorithms/" style="font-size: 20px">algorithms | </a>
        
        <a href="/tags/editors/" style="font-size: 16px">editors | </a>
        
        <a href="/tags/emacs/" style="font-size: 16px">emacs | </a>
        
        <a href="/tags/ai/" style="font-size: 14px">ai | </a>
        
        <a href="/tags/r/" style="font-size: 14px">r | </a>
        
        <a href="/tags/tools/" style="font-size: 16px">tools | </a>
        
        <a href="/tags/javascript/" style="font-size: 20px">javascript | </a>
        
        <a href="/tags/not_magic/" style="font-size: 14px">not_magic | </a>
        
        <a href="/tags/soft-skills/" style="font-size: 22px">soft-skills | </a>
        
        <a href="/tags/tricks/" style="font-size: 28px">tricks | </a>
        
        <a href="/tags/vscode/" style="font-size: 14px">vscode | </a>
        
        <a href="/tags/vim/" style="font-size: 16px">vim | </a>
        
        <a href="/tags/sublime/" style="font-size: 14px">sublime | </a>
        
        <a href="/tags/puzzle/" style="font-size: 18px">puzzle | </a>
        
        <a href="/tags/bash/" style="font-size: 16px">bash | </a>
        
        <a href="/tags/math/" style="font-size: 16px">math | </a>
        
        <a href="/tags/teaching/" style="font-size: 16px">teaching | </a>
        
        <a href="/tags/ruby/" style="font-size: 22px">ruby | </a>
        
        <a href="/tags/jekyll/" style="font-size: 16px">jekyll | </a>
        
        <a href="/tags/git/" style="font-size: 18px">git | </a>
        
        <a href="/tags/physics/" style="font-size: 14px">physics | </a>
        
        <a href="/tags/fun/" style="font-size: 18px">fun | </a>
        
        <a href="/tags/scientific/" style="font-size: 14px">scientific | </a>
        
        <a href="/tags/pythonic/" style="font-size: 16px">pythonic | </a>
        
        <a href="/tags/functional/" style="font-size: 16px">functional | </a>
        
        <a href="/tags/vue/" style="font-size: 22px">vue | </a>
        
        <a href="/tags/es6/" style="font-size: 20px">es6 | </a>
        
        <a href="/tags/tutorial/" style="font-size: 28px">tutorial | </a>
        
        <a href="/tags/exercise/" style="font-size: 14px">exercise | </a>
        
        <a href="/tags/fitness/" style="font-size: 14px">fitness | </a>
        
        <a href="/tags/sysadmin/" style="font-size: 16px">sysadmin | </a>
        
        <a href="/tags/linux/" style="font-size: 14px">linux | </a>
        
        <a href="/tags/html/" style="font-size: 16px">html | </a>
        
        <a href="/tags/seo/" style="font-size: 14px">seo | </a>
        
        <a href="/tags/social/" style="font-size: 14px">social | </a>
        
        <a href="/tags/metaprogramming/" style="font-size: 14px">metaprogramming | </a>
        
        <a href="/tags/css/" style="font-size: 14px">css | </a>
        
        <a href="/tags/front-end/" style="font-size: 14px">front-end | </a>
        
        <a href="/tags/animations/" style="font-size: 14px">animations | </a>
        
        <a href="/tags/p5/" style="font-size: 18px">p5 | </a>
        
        <a href="/tags/beginner/" style="font-size: 18px">beginner | </a>
        
        <a href="/tags/encouragement/" style="font-size: 18px">encouragement | </a>
        
        <a href="/tags/not-magic/" style="font-size: 14px">not-magic | </a>
        
        <a href="/tags/screencast/" style="font-size: 14px">screencast | </a>
        
        <a href="/tags/showdev/" style="font-size: 14px">showdev | </a>
        
        <a href="/tags/interview/" style="font-size: 14px">interview | </a>
        
        <a href="/tags/performance/" style="font-size: 14px">performance | </a>
        
        <a href="/tags/editor/" style="font-size: 14px">editor | </a>
        
        <a href="/tags/workflow/" style="font-size: 14px">workflow | </a>
        
        <a href="/tags/best-practice/" style="font-size: 14px">best-practice | </a>
        
        <a href="/tags/oss/" style="font-size: 14px">oss | </a>
        
        <a href="/tags/static-site/" style="font-size: 14px">static-site | </a>
        
      </p>
    </div>
  </div>
  <hr>
  

  <p class="rss-subscribe contact">Like my stuff?  Have questions or feedback for me?  Want to mentor me or get my help with something?  <a href="/about/">Get in touch!</a>  To stay updated, subscribe <a href="/feed.xml">via RSS</a></p>



</article>
        </div>

        <footer id="main-footer">
    <div class="container">
        <p class="text-muted">&copy; Ryan Palo 2017 | All things.  Phil. 4:13</p>
    </div>
</footer>
        <!-- Scripts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
        <script src="/js/main.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-91889165-1', 'auto');
            ga('send', 'pageview');

        </script>
        
    </body>
</html>
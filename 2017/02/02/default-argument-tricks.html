<!DOCTYPE html>
<html lang="en">
    <head>
        
        <!-- Bootstrap Setup -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">-->
        
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/syntax.css">
        
        <title>assert_not magic?</title>
    </head>
    <body>
        
<nav id="main-nav">
    <a href="/" class="mobile-home">assert_not magic?</a>
    <ul>
        <li class="logo"><a href="/">assert_not magic?</a></li>
        <li><a href="/posts/">All Posts</a></li>
        <li><a href="/about/">About</a></li>
        <li><a href="/sketches/">Sketches</a></li>
        <li><a href="/todo/">To-Do</a></li>
    </ul>
</nav>
        <div class="container main">
                <article class="site-wrap">
    <p>The other day I was working on a code challenge on <a href="https://www.codewars.com">CodeWars</a>.  I finished it up, feeling proud of myself (as one does), and moved on with my day.  A little while later, it struck me that I had done something that few of the other people that completed the challenge had done, and my solution (I thought humbly) was more elegant than some.  Here is a paraphrasing of the challenge.  </p>

<blockquote>
  <p>The following code snippet is a python version of an algorithm to produce the n-th number of the Fibonacci sequence.  For those that don’t know, the Fibonacci sequence is a sequence of numbers beginning with 0 and 1.  After that, each number, n, is calculated: n = (n-1) + (n-2).  More simply, each number is the sum to the two preceding numbers.  0, 1, 1, 2, 3, 5, 8, 13, 21…  The Fibonacci sequence is a good way to introduce recursive tree algorithms.  Without further ado, here’s a version of the algorithm.</p>
</blockquote>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes integer n.  Returns n-th Fibonacci number (integer).&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span></code></pre></div>

<blockquote>
  <p>Note that this algorithm is prohibitively inefficient.  It double calculates each number.  This solution effectively doesn’t work for n &gt; 50 or so.  One way to solve this is “memoization”, or caching the calculated results to speed up the process.  Create a memoized fibonacci function that keeps track of its calculated values.  Bonus points for making this cache private to the function.</p>
</blockquote>

<p>I highly encourage you to give this a try on your own.  There are lots of entirely valid ways.  The following is a <strong>SPOILER</strong>, and it gets the job done with a private cache.  Most importantly, it capitalizes on a feature of the language that is generally a common trip-up point for those newer to the concept.  Check it out!</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">memoFib</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Takes integer n and optional preloaded list of integers, cache.</span>
<span class="sd">    Returns the n-th Fibonacci number, and stores the results for future calculations.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cache</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">memoFib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">memoFib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></code></pre></div>

<p>If you see what I did, congratulations!  You’re amazing!  If not, congratulations!  You are <em>about</em> to be amazing!  Here’s the trick: in python (and other languages), if you have a default parameter in a function that is a mutable value, python doesn’t create a new one for each function call, it uses the same one every time.  I’ll explain more clearly.  Try the following.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">function_with_immutable_default</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;3 is an immutable number.  If you fiddle with b, it will</span>
<span class="sd">    simply make a copy because you can&#39;t, by definition, change/mutate it&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">return</span> <span class="n">b</span>

<span class="err">$</span> <span class="n">function_with_immutable_default</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="mi">5</span>
<span class="err">$</span> <span class="n">function_with_immutable_default</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="mi">3</span>

<span class="k">def</span> <span class="nf">function_with_mutable_default</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;Mutables are anything that can be modified in place without</span>
<span class="sd">    creating a new copy.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">b</span>

<span class="err">$</span> <span class="n">function_with_mutable_default</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="err">$</span> <span class="n">function_with_mutable_default</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="err">$</span> <span class="n">function_with_mutable_default</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span></code></pre></div>

<p>Do you begin to see?  In the second example, the list that is getting assigned to b doesn’t stand for a theoretical list that will get created every time the function is called.  You are assigning <em>that particular list</em> to b.  Anytime the function gets called, it will reach for <em>that</em> list.  If you call the function 5 times, that list will get accessed (and possibly modified) 5 times!</p>

<p>Hopefully this makes sense.  Anyhoo, this is the way I solved that problem and used a common gotcha for good instead of evil.  Do you have a better way to solve the problem?  Still confused about why the default argument works like a cache or what the difference between mutable and immutable is?  Please hit me up at hello@assertnotmagic.com and tell me about it!</p>

    <small>
        
        <a href="/tags/python/">python</a> 
        <a href="/tags/algorithms/">algorithms</a> 
        <a href="/tags/tricks/">tricks</a> 
</div>
        </div>

        <footer id="main-footer">
    <div class="container">
        <p class="text-muted">&copy; Ryan Palo 2017 | All things.  Phil. 4:13</p>
    </div>
</footer>
        <!-- Scripts -->
        <!--  
        jQuery (necessary for Bootstrap's JavaScript plugins)
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        Latest compiled and minified Bootstrap JavaScript
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        -->
        <!-- Custom Javascript -->
        <script src="/js/main.js"></script>
        
    </body>
</html>
<!DOCTYPE html>
<html lang="en">
    <head>
        
        <!-- Bootstrap Setup -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="ROBOTS" content="INDEX,FOLLOW">
        <meta name="description" content="An easy trick to speed up your slower functions">
        <meta name="keywords" content="blog, code, developer, programming, learning, teaching, dev, Ryan, Ryan Palo, python, tricks">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="assert_not magic? | Cache Me Outside">
        <meta name="twitter:site" content="@paytastic">
        <meta name="twitter:description" content="An easy trick to speed up your slower functions">
        <meta name="twitter:image" content="http://assertnotmagic.com/img/cache.png">
        <meta name="twitter:creator" content="@paytastic">
        <meta name="og:url" content="http://assertnotmagic.com/2017/05/18/cache-me-outside/">
        <meta name="og:title" content="assert_not magic? | Cache Me Outside">
        <meta name="og:description" content="An easy trick to speed up your slower functions">
        <meta name="og:image" content="http://assertnotmagic.com/img/cache.png">

        <!-- Favicon settings -->
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/manifest.json">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#222222">
        <meta name="theme-color" content="#ffffff">

        <!-- Omnisearch -->
        <link rel="search" type="application/opensearchdescription+xml" title="search assert_not magic" href="/opensearch.xml">
        
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">
        
        <link rel="stylesheet" href="/css/prism.css">
        <title>assert_not magic?</title>
    </head>
    <body>
        
<nav id="main-nav">
    <a href="/" class="mobile-home">assert_not magic?</a>
    <ul>
        <li class="logo"><a href="/">assert_not magic?</a></li>
        <li><a href="/posts/">All Posts</a></li>
        <li><a href="/about/">About Ryan</a></li>
        <li><a href="/sketches/">Sketches</a></li>
        <li><a href="/uses/">Uses</a></li>
    </ul>
</nav>
        <div class="container main">
                <article class="site-wrap">
    <div id="cover">
        
        <img alt="Cover Image" class="cover-image" src="/img/cache.png">
        
    </div>
    <h1>Cache Me Outside</h1>
    <p>I just came across a little nugget of wisdom after reading <a href="https://www.amin.space/blog/2017/5/elemental_speller/">this blog post</a> about making words out of Periodic Table Elements.  I highly recommend the read.  However, that’s not why we’re here.  We’re here to cache in on some of the benefits of Python’s standard library.</p>

<p>For those that don’t know, caching is really useful for when a function is getting called with the same arguments repeatedly and you can expect the same result each time.  Instead of calculating the result each time, you save the result in your cache for later.  This is especially useful for functions that intrinsically take a long time to run, like API calls, file I/O, or super-duper nested loops.  Consider, for a moment, our humble friend the Fibonacci function.  In Python, a common (but grossly inefficient) version goes something like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s">"""Finds the nth fibonacci number."""</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></code></pre></figure>

<p>It looks really nice and is pretty understandable.  But imagine it running at even <code>n = 5</code>.  Here’s a rough version of the call-stack:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">fibonacci</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">fibonacci</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">fibonacci</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">fibonacci</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="o">=</span> <span class="mi">2</span>
    <span class="n">fibonacci</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">fibonacci</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">fibonacci</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">fibonacci</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">fibonacci</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="o">=</span> <span class="mi">2</span>
        <span class="o">=</span> <span class="mi">3</span>
<span class="o">----------------</span>
<span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">=</span> <span class="mf">5.</span></code></pre></figure>

<p>And that’s only at # 5.  You can see how <code>fibonacci(2)</code> gets called <em>three times!</em>  Imagine what would happen if you tried to calculate <code>n = 10</code> or <code>n = 100</code>!  Don’t worry.  I did.  Actually, for <code>n = 100</code> I got too bored waiting for it to finish up.  In fact, I couldn’t even wait for <code>n = 50</code> to finish!  Even <code>n = 35</code> took like 7 seconds or so.  This is where the cache comes in.  You could probably make your own without too much trouble.  I tried a version way back in <a href="/2017/02/02/default-argument-tricks">this blog post</a>.  It came out pretty good if I do say so myself.  The only problem with adding a cache to a function is that it takes up a good number of lines of code and obscures what you actually want to show the function doing.  There are ways around that too, but why struggle and fight with that problem when the standard library (<em>trumpet fanfare</em>) has got you covered?</p>

<p>BEHOLD.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="c"># You should really look at the functools docs.</span>
<span class="c"># I mean it, there's some awesome stuff in there!</span>
<span class="c"># Also, FYI, LRU stands for Least Recently Used</span>
<span class="c"># which is the item that gets booted from the cache when</span>
<span class="c"># it hits its limit</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span> <span class="c"># Works best with maxsize as a power of 2.</span>
<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s">"""Finds the nth fibonacci number."""</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></code></pre></figure>

<p>Notice how I didn’t even change the main function?  I just thought to myself, “Oh, caching might be nice to have here,” and sprinkled a little decorator on top.  I’ll have to talk about decorators in another post, but just know that they’re used to augment functions, usually to add side-effects like registering a function somewhere or, like you might expect, adding a cache.  How much benefit did we gain?</p>

<p>Without the cache:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>python3 -m cProfile fib.py -n 40
102334155
         204668315 <span class="k">function </span>calls <span class="o">(</span>7 primitive calls<span class="o">)</span> <span class="k">in </span>89.028 seconds</code></pre></figure>

<p>Wowza.  With the cache:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>python3 -m cProfile fib.py -n 300
222232244629420445529739893461909967206666939096499764990979600
         323 <span class="k">function </span>calls <span class="o">(</span>24 primitive calls<span class="o">)</span> <span class="k">in </span>0.001 seconds</code></pre></figure>

<p>How bow dah?</p>

    
    <small>
        Author: Ryan Palo | Tags: 
        
        <a href="/tags/python/">python</a>
        
        <a href="/tags/tricks/">tricks</a>
        
    </small>
    
    <div class="email-background">
    <form class="email-signup" action="https://tinyletter.com/rpalo" method="post" target="popupwindow"
    onsubmit="window.open('https://tinyletter.com/rpalo', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
      <p>
        <label class="email-text" for="tlemail">Want to stay connected and get my newsletter?</label>
      </p>
      <p>
        <input class="email-input" type="text" name="email" id="tlemail" />
        <input type="hidden" value="1" name="embed" />
        <input class="email-button" type="submit" value="Subscribe" />
      </p>

        <a class="email-powered" href="https://tinyletter.com" target="_blank">powered by TinyLetter</a>
      </p>
    </form>
</div>
    <hr>

<!-- Footer for Homepage -->
  <div id="home-footer">
    <div id="left-home-footer">
      <!-- Featured Posts List -->
      <h2>Featured Posts</h2>
      <ul class="post-list">
        <li>
          <span class="post-meta">Jan 18, 2017</span><br />
          <a class="post-link" href="/2017/01/18/assert-not-magic/">Assert Not Magic</a>
        </li>
        
          <li>
            <span class="post-meta">Apr 22, 2018</span><br/>
            <a class="post-link" href="/2018/04/22/ruby-singleton-classes/">Ruby Concepts - Singleton Classes</a>
          </li>
        
          <li>
            <span class="post-meta">Apr 8, 2018</span><br/>
            <a class="post-link" href="/2018/04/08/convert-to-default-dict/">Dict Moves in Python</a>
          </li>
        
          <li>
            <span class="post-meta">Mar 28, 2018</span><br/>
            <a class="post-link" href="/2018/03/28/data-science-cardio-weather/">Data Science Cardio 1 - Weather</a>
          </li>
        
      </ul>
    </div>
    <div id="center-home-footer">
      <!-- Spacer -->
    </div>
    <div id="right-home-footer">
      <!-- Tags List -->
      <h2>Tags</h2>
      <p>
        
        <a href="/tags/python/" style="font-size: 60px">python | </a>
        
        <a href="/tags/django/" style="font-size: 22px">django | </a>
        
        <a href="/tags/rails/" style="font-size: 14px">rails | </a>
        
        <a href="/tags/algorithms/" style="font-size: 22px">algorithms | </a>
        
        <a href="/tags/editors/" style="font-size: 20px">editors | </a>
        
        <a href="/tags/emacs/" style="font-size: 16px">emacs | </a>
        
        <a href="/tags/ai/" style="font-size: 14px">ai | </a>
        
        <a href="/tags/r/" style="font-size: 14px">r | </a>
        
        <a href="/tags/tools/" style="font-size: 16px">tools | </a>
        
        <a href="/tags/javascript/" style="font-size: 26px">javascript | </a>
        
        <a href="/tags/not-magic/" style="font-size: 16px">not-magic | </a>
        
        <a href="/tags/soft-skills/" style="font-size: 22px">soft-skills | </a>
        
        <a href="/tags/tricks/" style="font-size: 38px">tricks | </a>
        
        <a href="/tags/vscode/" style="font-size: 16px">vscode | </a>
        
        <a href="/tags/vim/" style="font-size: 18px">vim | </a>
        
        <a href="/tags/sublime/" style="font-size: 14px">sublime | </a>
        
        <a href="/tags/puzzle/" style="font-size: 20px">puzzle | </a>
        
        <a href="/tags/bash/" style="font-size: 16px">bash | </a>
        
        <a href="/tags/math/" style="font-size: 16px">math | </a>
        
        <a href="/tags/teaching/" style="font-size: 16px">teaching | </a>
        
        <a href="/tags/ruby/" style="font-size: 32px">ruby | </a>
        
        <a href="/tags/jekyll/" style="font-size: 16px">jekyll | </a>
        
        <a href="/tags/git/" style="font-size: 20px">git | </a>
        
        <a href="/tags/physics/" style="font-size: 14px">physics | </a>
        
        <a href="/tags/fun/" style="font-size: 18px">fun | </a>
        
        <a href="/tags/scientific/" style="font-size: 16px">scientific | </a>
        
        <a href="/tags/pythonic/" style="font-size: 16px">pythonic | </a>
        
        <a href="/tags/functional/" style="font-size: 20px">functional | </a>
        
        <a href="/tags/vue/" style="font-size: 22px">vue | </a>
        
        <a href="/tags/es6/" style="font-size: 20px">es6 | </a>
        
        <a href="/tags/tutorial/" style="font-size: 34px">tutorial | </a>
        
        <a href="/tags/exercise/" style="font-size: 14px">exercise | </a>
        
        <a href="/tags/fitness/" style="font-size: 14px">fitness | </a>
        
        <a href="/tags/sysadmin/" style="font-size: 16px">sysadmin | </a>
        
        <a href="/tags/linux/" style="font-size: 14px">linux | </a>
        
        <a href="/tags/html/" style="font-size: 18px">html | </a>
        
        <a href="/tags/seo/" style="font-size: 14px">seo | </a>
        
        <a href="/tags/social/" style="font-size: 14px">social | </a>
        
        <a href="/tags/metaprogramming/" style="font-size: 14px">metaprogramming | </a>
        
        <a href="/tags/css/" style="font-size: 14px">css | </a>
        
        <a href="/tags/front-end/" style="font-size: 16px">front-end | </a>
        
        <a href="/tags/animations/" style="font-size: 14px">animations | </a>
        
        <a href="/tags/p5/" style="font-size: 20px">p5 | </a>
        
        <a href="/tags/beginner/" style="font-size: 20px">beginner | </a>
        
        <a href="/tags/encouragement/" style="font-size: 18px">encouragement | </a>
        
        <a href="/tags/screencast/" style="font-size: 14px">screencast | </a>
        
        <a href="/tags/showdev/" style="font-size: 14px">showdev | </a>
        
        <a href="/tags/interview/" style="font-size: 14px">interview | </a>
        
        <a href="/tags/performance/" style="font-size: 16px">performance | </a>
        
        <a href="/tags/workflow/" style="font-size: 14px">workflow | </a>
        
        <a href="/tags/best-practice/" style="font-size: 14px">best-practice | </a>
        
        <a href="/tags/oss/" style="font-size: 14px">oss | </a>
        
        <a href="/tags/static-site/" style="font-size: 14px">static-site | </a>
        
        <a href="/tags/big-o/" style="font-size: 14px">big-o | </a>
        
        <a href="/tags/linked-lists/" style="font-size: 14px">linked-lists | </a>
        
        <a href="/tags/design-intent/" style="font-size: 14px">design-intent | </a>
        
        <a href="/tags/struct/" style="font-size: 14px">struct | </a>
        
        <a href="/tags/browser/" style="font-size: 14px">browser | </a>
        
        <a href="/tags/focus/" style="font-size: 14px">focus | </a>
        
        <a href="/tags/productivity/" style="font-size: 18px">productivity | </a>
        
        <a href="/tags/codenewbie/" style="font-size: 14px">codenewbie | </a>
        
        <a href="/tags/reflection/" style="font-size: 14px">reflection | </a>
        
        <a href="/tags/update/" style="font-size: 14px">update | </a>
        
        <a href="/tags/preview/" style="font-size: 14px">preview | </a>
        
        <a href="/tags/gtd/" style="font-size: 14px">gtd | </a>
        
        <a href="/tags/bullet-journal/" style="font-size: 14px">bullet-journal | </a>
        
        <a href="/tags/data-science/" style="font-size: 14px">data-science | </a>
        
        <a href="/tags/singleton/" style="font-size: 14px">singleton | </a>
        
        <a href="/tags/basics/" style="font-size: 14px">basics | </a>
        
      </p>
    </div>
  </div>
  <hr>
  

  <p class="rss-subscribe contact">Like my stuff?  Have questions or feedback for me?  Want to mentor me or get my help with something?  <a href="/about/">Get in touch!</a>  To stay updated, subscribe <a href="/feed.xml">via RSS</a></p>



</article>
        </div>

        <footer id="main-footer">
    <div class="container">
        <p class="text-muted">&copy; Ryan Palo 2018 | All things.  Phil. 4:13</p>
    </div>
</footer>
        <!-- Scripts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
        <script src="/js/main.js"></script>
        <script src="/js/prism.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-91889165-1', 'auto');
            ga('send', 'pageview');

        </script>
        
    </body>
</html>
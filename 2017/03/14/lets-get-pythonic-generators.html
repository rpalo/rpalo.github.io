<!DOCTYPE html>
<html lang="en">
    <head>
        
        <!-- Bootstrap Setup -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">-->
        
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/syntax.css">
        
        <title>assert_not magic?</title>
    </head>
    <body>
        
<nav id="main-nav">
    <ul>
        <li class="logo"><a href="/">assert_not magic?</a></li>
        <li><a href="/posts/">All Posts</a></li>
        <li><a href="/about/">About</a></li>
        <li><a href="/todo/">To-Do</a></li>
    </ul>
</nav>
        <div class="container main">
                <div class="site-wrap">
    <p>A couple posts ago, I wrote about using generators to <a href="http://assertnotmagic.com/2017/02/24/optimal-primes.html">efficiently create prime numbers</a>. I think I promised then to go a little more in detail about them, which I am now doing here, thus proving that I am a dependable and trustworthy friend.  A little caveat.  Before I started writing this, I knew the basics, but I wanted to get a better grasp of the finer details.  <a href="http://intermediatepythonista.com/python-generators">This article</a> by Obi Ike-Nwosu is where I got most of my extra details.  In fact, this article will mostly be for me, to make sure I have a grasp on everything, and will contain a significant amount of the information from his original article.  I strongly recommend you check out <a href="http://intermediatepythonista.com/">The Intermediate Pythonista</a> for the abovementioned article and apparently many others as well.  For those of you committed to seeing me lay out a review of the same information in my own way, let us begin.</p>

<h2 id="digging-in">Digging In</h2>

<p>So.  Generators.  What are they?  Generators are a subset of a larger group of objects called <em>iterators</em>, which I’ll explain in a minute.  In short, generators (or, generator-iterators) are functions that, instead of simply returning a value at the end, will pause and save their state until the next time they are called to continue running.  Lemme ‘splain.  Have a gander at the following function:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">powers_of_two</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a list of the powers of two from start up to limit&quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>

    <span class="c"># For the pythonic at heart, this is probably more efficient</span>
    <span class="c"># return [2**i for i in range(start, limit)]</span></code></pre></div>

<p>A pretty common pattern, yes?  Create a full list, and then do stuff with that list.  Sum it, map it, print it, filter it, count it, graph it, etc.  One thing that is maybe a bummer is if you wanted to not use the whole list for some reason.  You are forced to create the whole thing and then use it.  Another bummer is if you are unsure of your limit!  What if you’re not sure how many powers it will take, you just want however many until <code>2**i &gt; 10000000</code>?  That is where generators come in, with the <code>yield</code> keyword.  Check it.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">shwoopy_powers_of_two</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generator that creates powers of two, beginning with start and, optionally stopping&quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="k">return</span></code></pre></div>

<p>In this newer version, the yield keyword is used.  Let’s see it in action:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">powers</span> <span class="o">=</span> <span class="n">shwoopy_powers_of_two</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>
<span class="mi">4</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>
<span class="mi">8</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">powers</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="c"># Same thing.</span>
<span class="mi">16</span></code></pre></div>

<p>As you can see, you can grab each of the values as you need them – lazily – rather than producing the entire list first.  But what is it??  Let’s see:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">powers</span> <span class="o">=</span> <span class="n">shwoopy_powers_of_two</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">powers</span> <span class="n">at</span> <span class="mh">0x10ee65b90</span><span class="o">&gt;</span></code></pre></div>

<p>It’s a generator!  But where are your items!?  Do you have to call next a bazillion times?  That’s exhausting!  No, don’t worry.  Most functions that take lists as inputs will also take these generator objects.  Look again:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">powers</span> <span class="o">=</span> <span class="n">shwoopy_powers_of_two</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># When you run through a generator object, you use it up!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>
<span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># No worries!  You can just reload it with your generator function.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># It&#39;s a factory!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">powers</span> <span class="o">=</span> <span class="n">shwoopy_powers_of_two</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">sum</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>
<span class="mi">1022</span></code></pre></div>

<h2 id="iterators">Iterators</h2>

<p>OK, back to the theory.  Just to clarify, generators, or generator functions, create generator objects.  These are disposable objects that you can call <code>next()</code> on to get values.  These generators are just quick and dirty ways to create generator objects though.  You can actually create your own (which is what the function does behind the scenes).  All you need to create an iterator object is an <code>__iter__</code> method.  All that you need to be an iterator object is a <code>next</code> method.  Generally, it is efficient to do both within the same object.  You’ll see.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Alphabet</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Iterator that provides the uppercase alphabet letters&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">65</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">90</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="c"># Use itself as the iterator object</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">:</span>
            <span class="n">this_one</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">)</span> <span class="c"># This is important!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">this_one</span>
            <span class="c"># This line gets ignored!</span>
        <span class="k">raise</span> <span class="ne">StopIteration</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Alphabet</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
<span class="o">...</span>    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">A</span>
<span class="n">B</span>
<span class="n">C</span>
<span class="n">D</span>
<span class="n">E</span>
<span class="n">F</span>
<span class="n">G</span> <span class="c"># You get the idea</span>
<span class="o">...</span></code></pre></div>

<p><strong>A note of warning!</strong>  When creating your own iterators, they do not pause execution in the middle of the next function like a <code>yield</code> would.  The important line in the above next function is that we update our current variable before we return anything.  Returning kicks us back to the top with whatever state we had at the time, leaving the last line of the while loop ignored!</p>

<p>The other thing of note that happened here (and which you can include in your generator functions as well) is the <code>StopIteration</code> exception.  When you throw that from within an iterator, it signals the for loop to stop looping.  If you come upon it by using the <code>next()</code> function, it will actually throw the StopIteration exception.</p>

<h2 id="bonus-1-generator-expressions">Bonus 1: Generator Expressions</h2>

<p>You know what are great?  List comprehensions.  Off topic, but a 15-second explanation.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<span class="o">...</span>    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">361</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># This can be accomplished with this simple list comprehension</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">361</span><span class="p">]</span></code></pre></div>

<p>Even greater is that you can create generators with a similar generator expression.  Simply use () instead of [] and your sequence will lazy load!</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x106072cd0</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="mi">2470</span></code></pre></div>

<p>So what’s the difference??  Generator expressions are throwaway versions that can only be used once.  They create items on the fly, however, so they use much less memory.  You should use them if you only need them once or if your sequence is very large.  If you need to loop over the sequence multiple times, stick to list comprehensions.</p>

<h2 id="bonus-2-recursive-yielding">Bonus 2: Recursive Yielding</h2>

<p>One more thing!  Generators can delegate to each other!  Here is a silly example, and then a useful example.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="n">ponger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generator one, delegates to two&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">yield</span> <span class="s">&quot;Ping!&quot;</span>
        <span class="k">yield from</span> <span class="n">ponger</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pong</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Generator two, delegates back to one&quot;&quot;&quot;</span>
    <span class="k">yield</span> <span class="s">&quot;Pong!&quot;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ping</span><span class="p">(</span><span class="n">pong</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">Ping</span><span class="err">!</span>
<span class="n">Pong</span><span class="err">!</span>
<span class="n">Ping</span><span class="err">!</span>
<span class="n">Pong</span><span class="err">!</span>
<span class="n">Ping</span><span class="err">!</span>
<span class="n">Pong</span><span class="err">!</span>
<span class="n">Ping</span><span class="err">!</span>
<span class="n">Pong</span><span class="err">!</span>
<span class="n">Ping</span><span class="err">!</span>
<span class="n">Pong</span><span class="err">!</span></code></pre></div>

<p>See?  You can kick into a different generator to get more values.  A more useful example from my previous post:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">prime_factors</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a list of the prime factors of a number&quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>
            <span class="k">yield from</span> <span class="n">prime_factors</span><span class="p">(</span><span class="n">number</span><span class="o">//</span><span class="n">i</span><span class="p">)</span>
            <span class="k">break</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">prime_factors</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span></code></pre></div>

<p>Recursive Generation!!!!  I guess, if you’ve already read the previous post, you’re not that surprised, but it’s cool, ja?  Anyways, there are a lot more things you can do with the new <code>yield from</code> keywords.  I suggest you check out the <a href="https://docs.python.org/3/whatsnew/3.3.html#pep-380">official documentation</a> for ideas.</p>

<h2 id="wrap-up">Wrap Up</h2>

<p>Whew!  This was a long one!  Like I said before, be sure to check out <a href="http://intermediatepythonista.com/python-generators">the Intermediate Pythonista’s take</a> on generators for similar information presented slightly differently.  Hopefully this article was helpful!</p>


</div>
        </div>

        <footer id="main-footer">
    <div class="container">
        <p class="text-muted">&copy; Ryan Palo 2017 | All things.  Phil. 4:13</p>
    </div>
</footer>
        <!-- Scripts -->
        <!--  
        jQuery (necessary for Bootstrap's JavaScript plugins)
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        Latest compiled and minified Bootstrap JavaScript
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        -->
        <!-- Custom Javascript -->
        <script src="/js/main.js"></script>
        
    </body>
</html>
<!DOCTYPE html>
<html lang="en">
    <head>
        
        <!-- Bootstrap Setup -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="ROBOTS" content="INDEX,FOLLOW">
        <meta name="description" content="Trying to get AI algorithms straight in my head.">
        <meta name="keywords" content="blog, code, developer, programming, learning, teaching, dev, Ryan, Ryan Palo, algorithms, python, ai">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="assert_not magic? | AI with Pacman">
        <meta name="twitter:site" content="@paytastic">
        <meta name="twitter:description" content="Trying to get AI algorithms straight in my head.">
        <meta name="twitter:image" content="http://assertnotmagic.com/img/pacman-algo.gif">
        <meta name="twitter:creator" content="@paytastic">
        <meta name="og:url" content="http://assertnotmagic.com/2016/10/16/ai-with-pacman/">
        <meta name="og:title" content="assert_not magic? | AI with Pacman">
        <meta name="og:description" content="Trying to get AI algorithms straight in my head.">
        <meta name="og:image" content="http://assertnotmagic.com/img/pacman-algo.gif">
        <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">-->
        
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/syntax.css">
        
        <title>assert_not magic?</title>
    </head>
    <body>
        
<nav id="main-nav">
    <a href="/" class="mobile-home">assert_not magic?</a>
    <ul>
        <li class="logo"><a href="/">assert_not magic?</a></li>
        <li><a href="/posts/">All Posts</a></li>
        <li><a href="/about/">About</a></li>
        <li><a href="/sketches/">Sketches</a></li>
        <li><a href="/todo/">To-Do</a></li>
    </ul>
</nav>
        <div class="container main">
                <article class="site-wrap">
    <div id="cover">
        
        <img alt="Cover Image" class="cover-image" src="/img/pacman-algo.gif">
        
    </div>
    <h1>AI with Pacman</h1>
    <p>I did it!  I know this post is late, but that’s because I wanted to conquer this project so I could post about it.  So that’s what I’m doing.  One of the courses I’m taking (of the many – I’ve got a short attention span.  I’m working on it) is an AI course on edX.  So far, it’s one of the most interesting courses I’ve taken.  It’s also one of the hardest classes (including my M.E. undergrad) I’ve ever taken.</p>

<p>Let me talk about the project.  The course provided a lot of the infrastructure for the Pacman game: displaying it, running it, testing it, grading it, etc.  Part of what made the project so hard was all of the files that were included – over 20!  I kind of imagine this is what getting a job at a tech company feels like, in micro-version.  I had to hunt through all of the files and figure out what did what and which classes got used where.  Luckily, the documentation and variable/function/class naming were on point, which made it fairly intuitive.</p>

<p>The main assignment was for me to build the brain for PacMan in various stages.  I’ll go through my solutions, which could definitely be improved, but they worked and I got the grade, so nyeh.  I was able to accidentally abstract quite a bit out, which ended up making much of the repetitive work super easy.  The first few questions asked me to implement various search algorithms, but as it turns out, they are basically all the same with a different sorting function.  You’ll see what I mean.</p>

<h2 id="generic-search-algorithm">Generic Search Algorithm</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">genericSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="c"># Inputs are a search problem - infrastructure provided by the class</span>
    <span class="c"># It has all the information about the current state, goal state, etc.</span>
    <span class="c"># They also made the util module available, which contains a Priority Queue</span>
    <span class="c"># which is the basis for the search.  Priority Queue is a queue that arranges by</span>
    <span class="c"># a given priority value.  Popping the lowest priority value can be done in O(1).</span>
    <span class="n">fringe</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">PriorityQueue</span><span class="p">()</span>
    <span class="n">closed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c"># My main piece of information I'm passing around is a tuple.</span>
    <span class="c"># (state, actions) -- state is the current game state</span>
    <span class="c"># containg relevant info like pacman's location, food locations, etc.</span>
    <span class="c"># Actions is what we eventually return, a list of 'N', 'S', 'E', 'W' directions</span>
    <span class="c"># to follow to win.</span>
    <span class="n">fringe</span><span class="o">.</span><span class="n">push</span><span class="p">((</span><span class="n">problem</span><span class="o">.</span><span class="n">getStartState</span><span class="p">(),</span> <span class="p">[]),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fringe</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="c"># Fringe should never be empty.  That's why we throw an exception</span>
            <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">"Fringe was empty!"</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">fringe</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">closed</span><span class="p">:</span>
            <span class="c"># I implemented a graph search, which doesn't expand nodes more than once for</span>
            <span class="c"># efficiency's sake.</span>
            <span class="k">continue</span>
        <span class="n">closed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">problem</span><span class="o">.</span><span class="n">isGoalState</span><span class="p">(</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c"># return the list of actions if we end up declaring victory</span>
            <span class="k">return</span> <span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># Otherwise, expand this current state, evaluate priorities based on the fn</span>
        <span class="c"># and add them to the fringe.</span>
        <span class="n">successors</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">getSuccessors</span><span class="p">(</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">successors</span><span class="p">:</span>
            <span class="n">nextOne</span> <span class="o">=</span> <span class="p">(</span><span class="n">successor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">successor</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">fringe</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nextOne</span><span class="p">,</span> <span class="n">fn</span><span class="p">(</span><span class="n">nextOne</span><span class="p">))</span></code></pre></figure>

<h2 id="search-algorithms">Search Algorithms</h2>

<p>Once that was complete, I could roll through the search algorithms fairly easily:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">depthFirstSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">):</span>
    <span class="s">"""Search the deepest nodes first"""</span>
    <span class="k">def</span> <span class="nf">priorityFn</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>    <span class="c"># Make sure the deepest nodes have the lowest priority</span>
                                    <span class="c"># so that they are popped off the queue first</span>
    <span class="k">return</span> <span class="n">genericSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">priorityFn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">breadthFirstSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">):</span>
    <span class="s">"""Search the shallowest nodes in the search tree first."""</span>
    <span class="k">def</span> <span class="nf">priorityFn</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>     <span class="c"># Make sure the shallowest nodes have low priority</span>
    <span class="k">return</span> <span class="n">genericSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">priorityFn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">uniformCostSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">):</span>
    <span class="s">"""Search the node of least total cost first."""</span>
    <span class="k">def</span> <span class="nf">priorityFn</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">problem</span><span class="o">.</span><span class="n">getCostOfActions</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">genericSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">priorityFn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">aStarSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">heuristic</span><span class="o">=</span><span class="n">nullHeuristic</span><span class="p">):</span>
    <span class="s">"""Search the node that has the lowest combined cost and heuristic first."""</span>
    <span class="k">def</span> <span class="nf">priorityFn</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">getCostOfActions</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">heuristic</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">problem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g</span> <span class="o">+</span> <span class="n">h</span>
    <span class="k">return</span> <span class="n">genericSearch</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">priorityFn</span><span class="p">)</span></code></pre></figure>

<h2 id="heuristics">Heuristics</h2>

<p>The next (and harder) thing is to implement heuristics for the A* search shown above.  A heuristic is an estimate of the cost from a state to the goal state.  When using a graph search, in order to guarantee optimal solutions, the heuristic needs to be “admissible” and “consistent.”  Admissible means that the heuristic never over-estimates the cost to the goal.  This is a delicate balance, though, because the larger the heuristic values, the faster the algorithm goes.  Consistency means that the cost from node to node is never less than the heuristic.  Luckily, consistency implies admissibility, and if you can get an admissible heuristic, it usually ends up being consistent.  The hard part is proving admissibility.</p>

<p>I used two main heuristics: a greedy Nearest Neighbor approach that worked really well but would not be admissible in certain geometries, and a really simple manhattan distance (x distance + y distance) heuristic that didn’t work as good but was definitely admissible.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">manhattanHeuristic</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{}):</span>
    <span class="s">"The Manhattan distance heuristic for a PositionSearchProblem"</span>
    <span class="c"># Provided by the class</span>
    <span class="n">xy1</span> <span class="o">=</span> <span class="n">position</span>
    <span class="n">xy2</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">goal</span>
    <span class="c"># Add up the city grid distance you would drive from point to point</span>
    <span class="c"># abs x distance + abs y distance</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xy1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xy2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xy1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xy2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">shortestDistance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">manhattanDistance</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="p">):</span>
    <span class="c"># Inspired by stackOverflow</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">initial</span>
    <span class="c"># Get the point that is closest to the start point.</span>
    <span class="c"># Then leapfrog to the next closest point to that one, adding up the distance.</span>
    <span class="c"># Return the full distance to get the the closest point and then loop through the rest of the points</span>
    <span class="c"># Recursively</span>

    <span class="c"># I could have probably done something more efficient by popping off of a list rather than recreate the list each time</span>
    <span class="n">shortest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">fn</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">shortestDistance</span><span class="p">(</span><span class="n">shortest</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">shortest</span><span class="p">],</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span> <span class="o">+</span> <span class="n">fn</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">shortest</span><span class="p">))</span></code></pre></figure>

<p>The other things were just expanding these concepts, working with problems of more than one dot, or four dots separated into the four corners, etc.  I could have gotten deeper into optimizing the shortest distance heuristic to work in all cases, but as I started to research this, I found out that that is a pretty standard CS problem without an easy solution.  I didn’t want to work that hard if the Manhattan heuristic would work just fine.  My only regret is that I couldn’t come up with one that automatically detected the worst-case behaviour of greedy Nearest Neighbor and regressed to the simple Manhattan heuristic.</p>

<h1 id="fun-link-time">Fun Link Time!</h1>

<p>I know this has been a thing for a long time, but <a href="https://www.codewars.com">CodeWars</a> is super neat.  The <a href="http://www.codenewbie.org">CodeNewbie</a> podcast put me onto it!  I’ve been using it to help me cultivate idiomatic grasps of Python (which I kind of already had) and Ruby and Javascript (which I definitely didn’t/still don’t/still working on it/don’t judge me/FOR-LOOPS).  That’s all for me though.  Talk more next time.</p>


    <small>
        
        <a href="/tags/algorithms/">algorithms</a>
        
        <a href="/tags/python/">python</a>
        
        <a href="/tags/ai/">ai</a>
        
    </small>
</article>
        </div>

        <footer id="main-footer">
    <div class="container">
        <p class="text-muted">&copy; Ryan Palo 2017 | All things.  Phil. 4:13</p>
    </div>
</footer>
        <!-- Scripts -->
        <!--  
        jQuery (necessary for Bootstrap's JavaScript plugins)
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        Latest compiled and minified Bootstrap JavaScript
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        -->
        <!-- Custom Javascript -->
        <script src="/js/main.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-91889165-1', 'auto');
            ga('send', 'pageview');

        </script>
        
    </body>
</html>